---
import type { HTMLAttributes } from 'astro/types'
import { getConfig, getVersionedBsJsPath } from '../libs/config'
import type { Layout } from '../libs/layout'
import StackBlitz from '../components/StackBlitz.astro'

interface Props {
  layout: Layout
}

const { layout } = Astro.props

const bsJsLinkProps: HTMLAttributes<'script'> = {
  src: getVersionedBsJsPath(),
}

if (import.meta.env.PROD) {
  bsJsLinkProps.crossorigin = 'anonymous'
  bsJsLinkProps.integrity = getConfig().params.cdn.js_bundle_hash
}
---

<script is:inline {...bsJsLinkProps}></script>

{
  layout === 'docs' && (
    <>
      <script is:inline src="https://cdn.jsdelivr.net/npm/@docsearch/js@3" />
      <StackBlitz />
    </>
  )
}

<!--
{{- $js := resources.Match "js/*.js" -}}
TODO(HiDeoo) This should prolly use getVersionedDocsPath()
{{- $targetDocsJSPath := path.Join "/docs" .Site.Params.docs_version "assets/js/docs.js" -}}
// TODO(HiDeoo) $vendor is no longer relevant as the only JS vendor was clipboard.js and is now bundled by Astro
{{- $docsJs := append $js $vendor | resources.Concat $targetDocsJSPath -}}

{{- if eq hugo.Environment "production" -}}
  {{- $docsJs = $docsJs | resources.Minify -}}
{{- end }}

<script src="{{ $docsJs.Permalink | relURL }}"></script>
-->

<!-- TODO(HiDeoo) Handle this with todo above, this is a temporary workaround to get some example requiring some JS to work -->
<script is:inline src="/js/snippets.js"></script>
